<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ZOMBIE VIRUS EXPERIMENT</title>
<meta name="theme-color" content="#050705"/>
<style>
  :root{
    --bg:#050705;
    --fg:#caffc8;
    --mut:#7eea74;
    --toxic:#4dff4d;
    --acid:#b8ff2b;
    --blood:#ff2a2a;
    --glass: rgba(12, 25, 12, .62);
    --stroke: rgba(170,255,170,.18);
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: var(--mono);
    color: var(--fg);
    background: radial-gradient(1000px 700px at 20% 10%, rgba(77,255,77,.10), transparent 55%),
                radial-gradient(900px 650px at 80% 30%, rgba(184,255,43,.08), transparent 55%),
                linear-gradient(180deg, #030503 0%, #050705 100%);
    overflow-x:hidden;
  }

  /* CRT scanlines + noise */
  body:before{
    content:"";
    position:fixed; inset:0;
    background:
      repeating-linear-gradient(
        to bottom,
        rgba(0,0,0,.22) 0px,
        rgba(0,0,0,.22) 2px,
        rgba(0,0,0,0) 4px
      );
    mix-blend-mode: multiply;
    pointer-events:none;
    opacity:.55;
  }
  body:after{
    content:"";
    position:fixed; inset:0;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.25'/%3E%3C/svg%3E");
    opacity:.18;
    pointer-events:none;
    mix-blend-mode:overlay;
  }

  .wrap{max-width:1100px;margin:0 auto;padding:22px 16px 80px}
  .top{
    display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;
    align-items:flex-start;margin:10px 0 14px;
  }
  .logo{
    display:flex;gap:12px;align-items:flex-start;
  }
  .bio{
    width:56px;height:56px;border-radius:16px;
    background: radial-gradient(16px 16px at 30% 30%, rgba(255,255,255,.25), transparent 60%),
                linear-gradient(135deg, rgba(77,255,77,.95), rgba(184,255,43,.88));
    box-shadow: 0 0 35px rgba(77,255,77,.18);
    border:1px solid rgba(170,255,170,.25);
    position:relative; overflow:hidden;
  }
  .bio:after{
    content:"BIO";
    position:absolute; inset:0;
    display:flex;align-items:center;justify-content:center;
    font-weight:900;color:rgba(0,0,0,.75);
    letter-spacing:.25em;
  }
  h1{
    margin:0;
    font-size: clamp(22px, 4.5vw, 44px);
    letter-spacing:.04em;
    text-transform:uppercase;
    text-shadow: 0 0 18px rgba(77,255,77,.25);
  }
  .sub{
    margin:8px 0 0;
    color: rgba(202,255,200,.72);
    max-width:760px;
    line-height:1.35;
  }

  .chips{display:flex;gap:10px;flex-wrap:wrap}
  .chip{
    padding:10px 12px;
    border-radius:999px;
    background: rgba(10,18,10,.55);
    border:1px solid var(--stroke);
    box-shadow: 0 12px 40px rgba(0,0,0,.55);
    color: rgba(202,255,200,.78);
  }
  .chip b{color:var(--toxic)}
  .chip .dot{
    display:inline-block;width:8px;height:8px;border-radius:99px;
    background: var(--toxic); box-shadow: 0 0 18px rgba(77,255,77,.55);
    margin-right:8px;
  }

  .grid{
    display:grid;
    grid-template-columns: 1.15fr .85fr;
    gap:14px;
    align-items:start;
  }
  @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }

  .panel{
    background: var(--glass);
    border:1px solid var(--stroke);
    border-radius:22px;
    box-shadow: 0 24px 90px rgba(0,0,0,.6);
    position:relative;
    overflow:hidden;
  }
  /* ‚Äú–≥—Ä—è–∑—å‚Äù */
  .panel:before{
    content:"";
    position:absolute; inset:0;
    background:
      radial-gradient(420px 240px at 20% 0%, rgba(77,255,77,.08), transparent 60%),
      radial-gradient(420px 240px at 85% 0%, rgba(184,255,43,.06), transparent 60%),
      radial-gradient(600px 360px at 50% 110%, rgba(255,42,42,.05), transparent 60%);
    pointer-events:none;
  }
  .in{position:relative;padding:16px}

  .row{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center}
  .title{
    font-weight:900;
    letter-spacing:.12em;
    text-transform:uppercase;
    color: rgba(202,255,200,.9);
  }
  .badge{
    font-size:12px;
    padding:8px 10px;
    border-radius:999px;
    border:1px solid rgba(170,255,170,.22);
    background: rgba(0,0,0,.25);
    color: rgba(202,255,200,.78);
  }
  .badge b{color:var(--acid)}
  .big{
    margin:12px 0 8px;
    font-size: clamp(16px, 2.3vw, 22px);
    line-height:1.3;
    text-shadow: 0 0 18px rgba(77,255,77,.12);
  }
  .muted{color: rgba(202,255,200,.62)}

  .k{
    display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;
  }
  .tag{
    padding:8px 10px;
    border-radius:999px;
    border:1px solid rgba(170,255,170,.18);
    background: rgba(0,0,0,.18);
    font-size:12px;
    color: rgba(202,255,200,.75);
  }
  .tag b{color: var(--toxic)}

  .ctrl{
    margin-top:10px;
    padding:12px;
    border-radius:18px;
    background: rgba(0,0,0,.22);
    border:1px solid rgba(170,255,170,.18);
  }
  input, textarea{
    width:100%;
    margin-top:8px;
    padding:12px;
    border-radius:14px;
    background: rgba(0,0,0,.30);
    border:1px solid rgba(170,255,170,.18);
    color: var(--fg);
    outline:none;
    font-family: var(--mono);
  }
  textarea{min-height:84px; resize: vertical}

  .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button{
    cursor:pointer;
    border:1px solid rgba(170,255,170,.22);
    background: rgba(0,0,0,.25);
    color: rgba(202,255,200,.92);
    font-family: var(--mono);
    font-weight:900;
    letter-spacing:.12em;
    text-transform:uppercase;
    padding:12px 14px;
    border-radius:16px;
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
  }
  button:hover{transform: translateY(-1px); box-shadow: 0 0 28px rgba(77,255,77,.12)}
  button:active{transform: translateY(1px)}
  .hot{
    background: linear-gradient(135deg, rgba(77,255,77,.95), rgba(184,255,43,.70));
    color: rgba(0,0,0,.85);
    border-color: rgba(200,255,200,.20);
  }
  .blood{
    border-color: rgba(255,42,42,.30);
    box-shadow: 0 0 28px rgba(255,42,42,.08);
  }

  .wall{
    display:grid;
    grid-template-columns: repeat(10, 1fr);
    gap:8px;
    margin-top:12px;
  }
  @media (max-width:720px){ .wall{grid-template-columns:repeat(6,1fr)} }
  @media (max-width:440px){ .wall{grid-template-columns:repeat(4,1fr)} }
  .cell{
    text-align:center;
    padding:10px 8px;
    border-radius:14px;
    border:1px solid rgba(170,255,170,.16);
    background: rgba(0,0,0,.20);
    color: rgba(202,255,200,.80);
    user-select:none;
  }
  .cell.me{
    border-color: rgba(77,255,77,.55);
    box-shadow: 0 0 0 2px rgba(77,255,77,.12) inset;
  }

  .toast{
    position: fixed; left:50%; bottom:18px;
    transform: translateX(-50%);
    padding:12px 14px;border-radius:999px;
    background: rgba(0,0,0,.70);
    border:1px solid rgba(170,255,170,.20);
    color: rgba(202,255,200,.92);
    opacity:0; pointer-events:none;
    transition: opacity .2s ease, transform .2s ease;
  }
  .toast.show{opacity:1; transform: translateX(-50%) translateY(-6px);}

  a{color:var(--acid); text-decoration:none}
  a:hover{text-decoration:underline}
</style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <div class="logo">
      <div class="bio" aria-hidden="true"></div>
      <div>
        <h1>ZOMBIE VIRUS EXPERIMENT</h1>
        <div class="sub">
          üß™ –≠—Ç–æ <b>–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –≤–∏—Ä—É—Å-—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç</b>. –ö–∞–∂–¥—ã–π –∑–∞—Ä–∞–∂—ë–Ω–Ω—ã–π –ø–æ–ª—É—á–∞–µ—Ç <b>–≥–ª–æ–±–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä</b>.
          –ù–∏–∫–∞–∫–∏—Ö –∞–≤—Ç–æ-—Ä–∞—Å—Å—ã–ª–æ–∫: –≤–∏—Ä—É—Å –∂–∏–≤—ë—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º—É —á—Ç–æ –ª—é–¥—è–º <b>—É–≥–∞—Ä–Ω–æ</b> –¥–µ–ª–∏—Ç—å—Å—è.
        </div>
      </div>
    </div>
    <div class="chips">
      <div class="chip"><span class="dot"></span>STATUS: <b id="st">BOOTING</b></div>
      <div class="chip">TOTAL: <b id="total">‚Ä¶</b></div>
    </div>
  </div>

  <div class="grid">
    <div class="panel">
      <div class="in">
        <div class="row">
          <div class="title">INFECTED PROFILE</div>
          <div class="badge">ID: <b id="myId">UNASSIGNED</b></div>
        </div>

        <div class="big" id="headline">YOU ARE INFECTED. GET YOUR NUMBER.</div>

        <div class="k">
          <div class="tag">BITTEN BY: <b id="from">SELF</b></div>
          <div class="tag">STRAIN: <b id="strain">‚Äî</b></div>
          <div class="tag">BITES: <b id="bites">0</b></div>
        </div>

        <div class="ctrl">
          <div class="muted">NICKNAME (–≤ —Ä–µ–µ—Å—Ç—Ä–µ)</div>
          <input id="nick" maxlength="20" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: isak / necro / boss"/>
        </div>

        <div class="btns">
          <button class="hot" id="btnTG">GET INFECTION NUMBER (TELEGRAM)</button>
          <button id="btnBite">CREATE BITE LINK</button>
          <button id="btnCopy">COPY SHARE TEXT</button>
          <button class="blood" id="btnReset">RESET LOCAL</button>
        </div>

        <div class="ctrl">
          <div class="muted">CHAIN (–∫—Ç–æ –æ—Ç –∫–æ–≥–æ)</div>
          <textarea id="chain" readonly>‚Äî</textarea>
        </div>

        <div class="ctrl">
          <div class="muted">MISSION (–∑–∞—Ç—è–≥–∏–≤–∞—é—â–∞—è —Ü–µ–ª—å)</div>
          <textarea id="mission" readonly>1) –ü–æ–ª—É—á–∏ –Ω–æ–º–µ—Ä.
2) –£–∫—É—Å–∏ 3 –ª—é–¥–µ–π.
3) –ü–æ–¥–Ω–∏–º–∏ ‚ÄúBITES‚Äù –∏ –ø–æ–ø–∞–¥–∏ –≤ TOP.
4) –ü–æ–π–º–∞–π —Ä–µ–¥–∫—É—é –º—É—Ç–∞—Ü–∏—é –≤ Telegram (/mutate).</textarea>
        </div>

        <div class="muted" style="margin-top:10px">
          üõ∞ Server: <a id="tgChannel" href="#" target="_blank" rel="noopener">Telegram channel</a>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="in">
        <div class="row">
          <div class="title">LIVE WALL</div>
          <div class="badge">LAST <b>60</b></div>
        </div>
        <div class="muted">–ù–∞–∂–º–∏ –Ω–æ–º–µ—Ä ‚Üí —Å–∫–æ–ø–∏—Ä—É–µ—Ç —É–∫—É—Å-—Å—Å—ã–ª–∫—É –æ—Ç —ç—Ç–æ–≥–æ –∑–∞—Ä–∞–∂—ë–Ω–Ω–æ–≥–æ.</div>
        <div class="wall" id="wall"></div>

        <div class="ctrl">
          <div class="muted">TOP SPREADERS</div>
          <textarea id="top" readonly>‚Äî</textarea>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast">ok</div>

<script>
(() => {
  // ====== –ù–ê–°–¢–†–û–ô–ö–ò (–ø–æ–º–µ–Ω—è–µ—à—å 2 —Å—Ç—Ä–æ–∫–∏, –≤—Å—ë) ======
  const TELEGRAM_BOT = "ZombieVirusLabBot";     // –±–µ–∑ @
  const TELEGRAM_CHANNEL = "zombievirus_server"; // –±–µ–∑ @
  // =================================================

  const $ = (id) => document.getElementById(id);
  const toast = (m)=>{ const t=$("toast"); t.textContent=m; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1400); };

  const LS = "zombie_site_v1";
  const state = { id:null, nick:"", strain:"", from_id:null, from_nick:null };

  function load(){
    try{ const raw=localStorage.getItem(LS); if(raw) Object.assign(state, JSON.parse(raw)); }catch(e){}
  }
  function save(){ localStorage.setItem(LS, JSON.stringify(state)); }

  function sanitizeNick(s){ return String(s||"").trim().slice(0,20).replace(/[^\p{L}\p{N}_\-. ]/gu,""); }

  function parseParams(){
    const p = new URLSearchParams(location.search);
    const id = p.get("id");
    const from_id = p.get("from_id");
    const from = p.get("from");
    const strain = p.get("strain");

    if(id && !state.id){
      const n = parseInt(id,10);
      if(Number.isFinite(n)) state.id = n;
    }
    if(from_id && !state.from_id){
      const n = parseInt(from_id,10);
      if(Number.isFinite(n)) state.from_id = n;
    }
    if(from && !state.from_nick) state.from_nick = sanitizeNick(from);
    if(strain && !state.strain) state.strain = String(strain).toUpperCase().slice(0,8);
  }

  function biteLink(fromId, fromNick){
    const u = new URL(location.href);
    u.searchParams.set("from_id", String(fromId));
    u.searchParams.set("from", sanitizeNick(fromNick||"anon"));
    return u.toString();
  }

  function tgStartLink(){
    // –ü–µ—Ä–µ–¥–∞—ë–º –≤ –±–æ—Ç –∫—Ç–æ —Ç–µ–±—è —É–∫—É—Å–∏–ª + –Ω–∏–∫ (–¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã)
    const from = state.from_id ? `f${state.from_id}` : "f0";
    const nick = state.from_nick ? state.from_nick : "self";
    const payload = encodeURIComponent(`${from}_${nick}`);
    return `https://t.me/${TELEGRAM_BOT}?start=${payload}`;
  }

  async function copy(text){
    try{ await navigator.clipboard.writeText(text); toast("COPIED"); }catch(e){ toast("COPY FAILED"); }
  }

  // registry.json (–±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –±–æ—Ç–æ–º ‚Äî —Å–º. bot.py –Ω–∏–∂–µ)
  let registry = null;

  async function fetchRegistry(){
    try{
      $("st").textContent="SYNC";
      const r = await fetch("./registry.json?cache="+Date.now(), {cache:"no-store"});
      if(!r.ok) throw new Error("no registry");
      registry = await r.json();
      $("total").textContent = String(registry.total || (registry.infections?.length||0));
      $("st").textContent="LIVE";
      render();
    }catch(e){
      $("st").textContent="OFFLINE";
      $("total").textContent="‚Äî";
      render();
    }
  }

  function meInRegistry(){
    if(!registry?.infections || !state.id) return null;
    return registry.infections.find(x => x && x.id === state.id) || null;
  }

  function countBites(myId){
    if(!registry?.infections || !myId) return 0;
    return registry.infections.filter(x => x && x.from_id === myId).length;
  }

  function chainOf(me){
    if(!registry?.infections || !me) return "‚Äî";
    const map = new Map(registry.infections.map(x=>[x.id,x]));
    const out = [];
    let cur = me; let guard=0;
    while(cur && guard<64){
      out.push(`#${cur.id} @${cur.nick||"anon"}`);
      if(!cur.from_id) break;
      cur = map.get(cur.from_id);
      guard++;
    }
    return out.join(" -> ");
  }

  function topSpreaders(){
    if(!registry?.infections) return "‚Äî";
    const cnt = new Map();
    for(const x of registry.infections){
      if(!x?.from_id) continue;
      cnt.set(x.from_id, (cnt.get(x.from_id)||0)+1);
    }
    const map = new Map(registry.infections.map(x=>[x.id,x]));
    const top = [...cnt.entries()].sort((a,b)=>b[1]-a[1]).slice(0,10);
    if(top.length===0) return "No spreaders yet. Be the first.";
    return top.map(([id,c],i)=>{
      const who = map.get(id);
      const name = who ? `@${who.nick||"anon"}` : "@unknown";
      return `${String(i+1).padStart(2,"0")}. #${id} ${name} ‚Äî ${c} bites`;
    }).join("\n");
  }

  function renderWall(){
    const wall = $("wall");
    wall.innerHTML="";
    const total = registry?.total || registry?.infections?.length || 0;
    const show = 60;
    const start = Math.max(1, total - show + 1);

    for(let id=start; id<=total; id++){
      const div = document.createElement("div");
      div.className="cell";
      div.textContent = "#"+id;
      if(state.id && id===state.id) div.classList.add("me");

      div.addEventListener("click", ()=>{
        // –∫–æ–ø–∏—Ä—É–µ–º —É–∫—É—Å-—Å—Å—ã–ª–∫—É –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ id
        const inf = registry?.infections?.find(x=>x && x.id===id);
        if(!inf) return toast("NO DATA");
        copy(biteLink(id, inf.nick||"anon"));
      });

      wall.appendChild(div);
    }
  }

  function render(){
    $("tgChannel").href = `https://t.me/${TELEGRAM_CHANNEL}`;

    $("nick").value = state.nick || "";
    $("from").textContent = state.from_id ? `#${state.from_id}${state.from_nick?(" @"+state.from_nick):""}` : (state.from_nick ? "@"+state.from_nick : "SELF");
    $("strain").textContent = state.strain || "‚Äî";

    if(state.id){
      $("myId").textContent = "#"+state.id;
      $("headline").textContent = `INFECTED CONFIRMED. YOU ARE #${state.id}.`;
    }else{
      $("myId").textContent = "UNASSIGNED";
      $("headline").textContent = "YOU ARE INFECTED. GET YOUR NUMBER.";
    }

    if(registry){
      const me = meInRegistry();
      if(me){
        $("strain").textContent = me.strain || $("strain").textContent;
        $("chain").value = chainOf(me);
      } else {
        $("chain").value = state.id ? "Not in wall yet. Wait 5‚Äì30 sec then refresh." : "‚Äî";
      }

      const bites = state.id ? countBites(state.id) : 0;
      $("bites").textContent = String(bites);
      $("top").value = topSpreaders();
      renderWall();
    } else {
      $("top").value = "Registry offline. Telegram feed still works.";
      $("chain").value = "‚Äî";
      $("bites").textContent = "0";
      $("wall").innerHTML = "";
    }

    save();
  }

  // UI actions
  $("nick").addEventListener("input", ()=>{
    state.nick = sanitizeNick($("nick").value);
    save();
  });

  $("btnTG").addEventListener("click", ()=>{
    // –∏–¥—ë–º –≤ –±–æ—Ç ‚Äî —Ç–∞–º –≤—ã–¥–∞–¥—É—Ç –Ω–æ–º–µ—Ä –∏ –≤–µ—Ä–Ω—É—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∞–π—Ç —Å ?id=
    window.open(tgStartLink(), "_blank", "noopener,noreferrer");
    toast("OPEN TELEGRAM BOT");
  });

  $("btnBite").addEventListener("click", ()=>{
    if(!state.id){ toast("GET NUMBER FIRST"); return; }
    const link = biteLink(state.id, state.nick||"anon");
    copy(link);
  });

  $("btnCopy").addEventListener("click", ()=>{
    const me = state.id ? `#${state.id}` : "UNASSIGNED";
    const link = state.id ? biteLink(state.id, state.nick||"anon") : `https://t.me/${TELEGRAM_BOT}`;
    const msg =
`üßü ZOMBIE VIRUS EXPERIMENT
I am infected: ${me}
Get your infection number here:
${link}

(virtual virus experiment ‚Äî meme game)`;
    copy(msg);
  });

  $("btnReset").addEventListener("click", ()=>{
    localStorage.removeItem(LS);
    location.search = "";
  });

  // Init
  load();
  parseParams();
  render();
  fetchRegistry();
  setInterval(fetchRegistry, 15000);
})();
</script>
</body>
</html>
