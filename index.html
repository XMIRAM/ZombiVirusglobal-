<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ЗомбиГлобал</title>
  <style>
    :root{
      --bg:#070a10;
      --ink:#e9fff2;
      --muted:rgba(233,255,242,.70);
      --g:#5CFF7A;
      --c:#37E6FF;
      --p:#B36BFF;
      --y:#FFD66B;
      --r:18px;
      --shadow:0 22px 90px rgba(0,0,0,.55);
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      --ui: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); font-family:var(--ui);
      background: radial-gradient(1200px 900px at 20% 15%, rgba(92,255,122,.14), transparent 60%),
                  radial-gradient(900px 650px at 80% 25%, rgba(55,230,255,.12), transparent 62%),
                  radial-gradient(900px 650px at 55% 85%, rgba(179,107,255,.10), transparent 62%),
                  linear-gradient(180deg,#070a10,#05070c);
      overflow:hidden;
    }

    /* ===== BACKGROUND (game vibe) ===== */
    .bg{
      position:fixed; inset:0; z-index:0;
      display:grid; place-items:center;
      background:
        radial-gradient(900px 520px at 50% 30%, rgba(92,255,122,.16), transparent 60%),
        radial-gradient(740px 420px at 55% 75%, rgba(55,230,255,.12), transparent 65%),
        radial-gradient(900px 520px at 40% 85%, rgba(179,107,255,.10), transparent 65%);
    }
    .bg video, .bg img{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit:cover;
      transform:scale(1.05);
      filter:saturate(1.05) contrast(1.05) brightness(.72);
      opacity:.95;
    }
    .bg::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 800px at 50% 20%, rgba(0,0,0,.05), rgba(0,0,0,.55) 62%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.60));
      pointer-events:none;
    }
    .noise{
      position:fixed; inset:0; z-index:1; pointer-events:none;
      opacity:.10; mix-blend-mode:overlay;
      background: repeating-linear-gradient(0deg, rgba(255,255,255,.05) 0, rgba(255,255,255,.05) 1px, transparent 2px, transparent 4px);
    }
    .sparks{
      position:fixed; inset:0; z-index:1; pointer-events:none; opacity:.55;
      background:
        radial-gradient(2px 2px at 12% 28%, rgba(92,255,122,.75), transparent 60%),
        radial-gradient(2px 2px at 26% 62%, rgba(55,230,255,.70), transparent 60%),
        radial-gradient(2px 2px at 72% 22%, rgba(179,107,255,.70), transparent 60%),
        radial-gradient(2px 2px at 86% 58%, rgba(255,214,107,.70), transparent 60%),
        radial-gradient(2px 2px at 44% 78%, rgba(92,255,122,.65), transparent 60%);
      filter: blur(.2px);
      animation: float 6s ease-in-out infinite alternate;
    }
    @keyframes float{ from{transform:translateY(0)} to{transform:translateY(-10px)} }

    /* ===== LAYOUT ===== */
    .wrap{
      position:relative; z-index:2;
      height:100%; width:min(1100px, calc(100% - 24px));
      margin:0 auto; padding:18px 0 22px;
      display:flex; flex-direction:column; gap:14px;
    }

    /* Top HUD */
    .hud{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      padding:12px 14px;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(7,10,16,.62);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:
        radial-gradient(circle at 35% 35%, rgba(92,255,122,.95), rgba(92,255,122,.12) 52%, transparent 62%),
        radial-gradient(circle at 70% 65%, rgba(55,230,255,.30), transparent 60%),
        linear-gradient(180deg, rgba(10,16,14,.9), rgba(6,8,12,.9));
      border:1px solid rgba(92,255,122,.25);
      box-shadow: 0 0 0 1px rgba(55,230,255,.10) inset;
    }
    .title{line-height:1}
    .title .t{font-family:var(--mono); letter-spacing:.10em; font-weight:900; text-transform:uppercase; font-size:14px}
    .title .s{font-family:var(--mono); letter-spacing:.06em; font-size:11px; color:var(--muted); margin-top:4px}

    .hudRight{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(6,8,12,.55);
      font-family:var(--mono); font-size:12px; color:rgba(233,255,242,.9);
      user-select:none;
    }
    .dot{width:8px;height:8px;border-radius:50%}
    .g{background:var(--g); box-shadow:0 0 14px rgba(92,255,122,.45)}
    .c{background:var(--c); box-shadow:0 0 14px rgba(55,230,255,.35)}
    .p{background:var(--p); box-shadow:0 0 14px rgba(179,107,255,.35)}
    .y{background:var(--y); box-shadow:0 0 14px rgba(255,214,107,.25)}

    /* Main stage */
    .stage{
      flex:1;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .stage{grid-template-columns:1fr}
    }

    .panel{
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(7,10,16,.62);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelHead{
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .panelHead b{
      font-family:var(--mono); letter-spacing:.10em; text-transform:uppercase; font-size:12px;
    }
    .panelBody{padding:14px}

    .big{
      font-family:var(--mono);
      font-weight:900;
      letter-spacing:.04em;
      text-transform:uppercase;
      font-size:34px;
      line-height:1.05;
      margin:0;
    }
    .sub{
      margin:10px 0 0;
      color:var(--muted);
      font-size:14px;
      line-height:1.55;
      max-width:68ch;
    }

    /* GAME BUTTONS */
    .btns{display:flex; flex-wrap:wrap; gap:10px; margin-top:14px}
    .btn{
      border:0; cursor:pointer; user-select:none;
      padding:12px 14px; border-radius:14px;
      font-family:var(--mono); font-weight:900;
      letter-spacing:.08em; text-transform:uppercase; font-size:12px;
      color:rgba(233,255,242,.95);
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      transition: transform .08s ease, filter .15s ease;
    }
    .btn:hover{filter:brightness(1.08)}
    .btn:active{transform:translateY(1px)}
    .btn.g{border-color:rgba(92,255,122,.35); background:linear-gradient(180deg, rgba(92,255,122,.26), rgba(92,255,122,.08))}
    .btn.c{border-color:rgba(55,230,255,.32); background:linear-gradient(180deg, rgba(55,230,255,.22), rgba(55,230,255,.06))}
    .btn.p{border-color:rgba(179,107,255,.30); background:linear-gradient(180deg, rgba(179,107,255,.22), rgba(179,107,255,.06))}
    .btn.y{border-color:rgba(255,214,107,.30); background:linear-gradient(180deg, rgba(255,214,107,.20), rgba(255,214,107,.06))}
    .btn:disabled{opacity:.45; cursor:not-allowed; filter:saturate(.7)}

    /* Profile cards */
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:14px}
    @media (max-width: 560px){ .grid2{grid-template-columns:1fr} }
    .card{
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(6,8,12,.55);
      padding:12px;
    }
    .k{font-family:var(--mono); font-size:11px; letter-spacing:.10em; text-transform:uppercase; color:rgba(233,255,242,.65)}
    .v{margin-top:6px; font-family:var(--mono); font-size:18px; font-weight:900}
    .v.g{color:var(--g); text-shadow:0 0 18px rgba(92,255,122,.20)}
    .v.c{color:var(--c); text-shadow:0 0 18px rgba(55,230,255,.16)}

    /* Simple “screens” */
    .screen{display:none}
    .screen.show{display:block}

    table{width:100%; border-collapse:collapse; font-family:var(--mono); font-size:12px; overflow:hidden; border-radius:14px}
    th,td{padding:10px; border-bottom:1px solid rgba(255,255,255,.10); text-align:left}
    th{color:rgba(233,255,242,.75); letter-spacing:.10em; text-transform:uppercase; font-size:11px}
    tr:hover td{background:rgba(255,255,255,.05)}
    .num{color:var(--g); font-weight:900}

    /* Toast */
    .toast{
      position:fixed; left:50%; bottom:14px; transform:translateX(-50%);
      z-index:20;
      background: rgba(7,10,16,.78);
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px;
      padding:12px 14px;
      font-family:var(--mono); font-size:12px; color:rgba(233,255,242,.92);
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      display:none;
      max-width:min(720px, calc(100vw - 24px));
    }
    .toast.show{display:block}
  </style>
</head>

<body>
  <div class="bg" id="bg">
    <!-- VIDEO BACKGROUND: будет работать, если задашь BG_VIDEO_URL в JS -->
    <video id="bgVid" autoplay muted loop playsinline></video>
    <!-- если хочешь вместо видео картинку/гиф: BG_IMAGE_URL -->
    <img id="bgImg" alt="" style="display:none" />
  </div>
  <div class="noise"></div>
  <div class="sparks"></div>

  <div class="wrap">
    <!-- HUD -->
    <div class="hud">
      <div class="brand">
        <div class="logo"></div>
        <div class="title">
          <div class="t">ЗомбиГлобал</div>
          <div class="s">ARCADE OUTBREAK • MEME GAME</div>
        </div>
      </div>
      <div class="hudRight">
        <div class="pill"><span class="dot g"></span>ID <span id="hudId">—</span></div>
        <div class="pill"><span class="dot c"></span>BY <span id="hudBy">—</span></div>
        <div class="pill"><span class="dot y"></span>INF <span id="hudInf">—</span></div>
        <button class="btn c" id="btnCopyHud" disabled>COPY LINK</button>
      </div>
    </div>

    <div class="stage">
      <!-- LEFT: MAIN GAME -->
      <div class="panel">
        <div class="panelHead">
          <b id="screenTitle">MAIN MENU</b>
          <div class="pill"><span class="dot p"></span><span id="refHint">ref: —</span></div>
        </div>

        <div class="panelBody">
          <!-- MENU -->
          <div class="screen show" id="menu">
            <h1 class="big">Outbreak Arena</h1>
            <p class="sub">
              Это <b>игровой реестр заражения</b>. Получи номер → заражай друзей → поднимайся в топ → оставь цепочку.
            </p>
            <div class="btns">
              <button class="btn g" id="btnClaim">GET INFECTION ID</button>
              <button class="btn c" id="btnInfect" disabled>INFECT FRIEND</button>
              <button class="btn p" id="goTop">LEADERBOARD</button>
              <button class="btn y" id="goChain">LINEAGE</button>
            </div>

            <div class="grid2">
              <div class="card">
                <div class="k">Your Infection</div>
                <div class="v g" id="meNum">—</div>
              </div>
              <div class="card">
                <div class="k">Share Link</div>
                <div class="v" id="meLink" style="font-size:12px;color:rgba(233,255,242,.85);word-break:break-all">—</div>
              </div>
            </div>

            <div class="btns" style="margin-top:12px">
              <a class="btn c" href="https://t.me/zombievirus_server" target="_blank" rel="noreferrer">OPEN SERVER</a>
              <a class="btn c" href="https://t.me/ZombieVirusLabBot" target="_blank" rel="noreferrer">OPEN BOT</a>
              <button class="btn" id="btnReset">RESET DEMO</button>
            </div>
          </div>

          <!-- TOP -->
          <div class="screen" id="top">
            <p class="sub" style="margin:0 0 10px">Локальный топ (демо). Глобальный подключим после того, как визуал станет идеальный.</p>
            <table>
              <thead><tr><th>#</th><th>Infection</th><th>Infections</th><th>By</th></tr></thead>
              <tbody id="lb">
                <tr><td style="color:rgba(233,255,242,.6)">—</td><td class="num">—</td><td style="color:rgba(233,255,242,.6)">—</td><td style="color:rgba(233,255,242,.6)">—</td></tr>
              </tbody>
            </table>
            <div class="btns" style="margin-top:12px">
              <button class="btn p" id="back1">BACK</button>
            </div>
          </div>

          <!-- CHAIN -->
          <div class="screen" id="chain">
            <p class="sub" style="margin:0 0 10px">Цепочка “кто кого” (демо). Это будет самое мемное.</p>
            <div class="card">
              <div class="k">Lineage</div>
              <div class="v" id="chainTxt" style="font-size:14px;color:rgba(233,255,242,.9)">—</div>
            </div>
            <div class="btns" style="margin-top:12px">
              <button class="btn y" id="btnBuild">BUILD CHAIN</button>
              <button class="btn p" id="back2">BACK</button>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT: PLAYER HUD / MISSION -->
      <div class="panel">
        <div class="panelHead">
          <b>PLAYER</b>
          <div class="pill"><span class="dot g"></span>DEMO</div>
        </div>
        <div class="panelBody">
          <div class="grid2" style="margin-top:0">
            <div class="card">
              <div class="k">ID</div>
              <div class="v g" id="pId">—</div>
            </div>
            <div class="card">
              <div class="k">INFECTED BY</div>
              <div class="v c" id="pBy">—</div>
            </div>
            <div class="card">
              <div class="k">INFECTIONS</div>
              <div class="v g" id="pInf">—</div>
            </div>
            <div class="card">
              <div class="k">MISSION</div>
              <div class="v" style="font-size:12px;color:rgba(233,255,242,.86);line-height:1.5">
                1) Get ID<br/>
                2) Copy link<br/>
                3) Infect friends<br/>
                4) Climb Top
              </div>
            </div>
          </div>

          <div class="btns" style="margin-top:12px">
            <button class="btn c" id="btnCopy" disabled>COPY LINK</button>
            <button class="btn g" id="btnFull">FULLSCREEN</button>
          </div>

          <p class="sub" style="margin-top:12px">
            ⚠️ Это игра-мем. Не реальный вирус.<br/>
            Фон будет выглядеть как “жёсткая игра”, когда ты поставишь свой <b>zombie crowd</b> фон (видео/гиф).
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ====== ВСТАВЬ СЮДА СВОЙ ФОН (видео/гиф) ======
    // Можно дать прямую ссылку на mp4/webm (GitHub raw / CDN).
    const BG_VIDEO_URL = ""; // например: "https://.../zombie-crowd.mp4"
    const BG_IMAGE_URL = ""; // если хочешь картинку/гиф вместо видео

    // ====== DEMO STATE (локально) ======
    const LS = "zg_game_v1";
    const $ = (id)=>document.getElementById(id);
    const toastEl = $("toast");

    const fmt = (n)=>"#"+String(n).padStart(6,"0");

    function toast(t){
      toastEl.textContent = t;
      toastEl.classList.add("show");
      setTimeout(()=>toastEl.classList.remove("show"), 2200);
    }

    function getRef(){
      const u = new URL(location.href);
      const r = u.searchParams.get("ref");
      const num = r ? Number(r) : null;
      return Number.isFinite(num) ? num : null;
    }
    function buildLink(id){
      const u = new URL(location.href);
      u.searchParams.set("ref", String(id));
      u.hash = "";
      return u.toString();
    }

    function load(){
      try{ return JSON.parse(localStorage.getItem(LS) || "null"); }catch{ return null; }
    }
    function save(s){ localStorage.setItem(LS, JSON.stringify(s)); }
    function init(){
      const s = load() || { next:1, me:null, users:{} };
      save(s);
      return s;
    }

    function show(screen){
      ["menu","top","chain"].forEach(x=>$(x).classList.toggle("show", x===screen));
      $("screenTitle").textContent = screen==="menu" ? "MAIN MENU" : screen==="top" ? "LEADERBOARD" : "LINEAGE";
    }

    async function copyLink(){
      const s = init();
      if(!s.me) return;
      const link = buildLink(s.me.id);
      try{
        await navigator.clipboard.writeText(link);
        toast("LINK COPIED");
      }catch{
        toast("COPY FAILED (browser)");
      }
    }

    function render(){
      const s = init();
      const ref = getRef();
      $("refHint").textContent = "ref: " + (ref ? fmt(ref) : "—");

      const me = s.me;
      $("hudId").textContent = me ? fmt(me.id) : "—";
      $("hudBy").textContent = me ? (me.by ? fmt(me.by) : "—") : "—";
      $("hudInf").textContent = me ? String(me.inf||0) : "—";

      $("meNum").textContent = me ? fmt(me.id) : "—";
      $("meLink").textContent = me ? buildLink(me.id) : "—";

      $("pId").textContent = me ? fmt(me.id) : "—";
      $("pBy").textContent = me ? (me.by ? fmt(me.by) : "—") : "—";
      $("pInf").textContent = me ? String(me.inf||0) : "—";

      const has = !!me;
      $("btnInfect").disabled = !has;
      $("btnCopy").disabled = !has;
      $("btnCopyHud").disabled = !has;

      // local leaderboard
      const rows = Object.values(s.users).sort((a,b)=>(b.inf||0)-(a.inf||0) || a.id-b.id);
      const tb = $("lb");
      tb.innerHTML = rows.length ? "" : `<tr><td style="color:rgba(233,255,242,.6)">—</td><td class="num">—</td><td style="color:rgba(233,255,242,.6)">—</td><td style="color:rgba(233,255,242,.6)">—</td></tr>`;
      rows.slice(0,25).forEach((u,i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td style="color:rgba(233,255,242,.65)">#${i+1}</td>
                        <td class="num">${fmt(u.id)}</td>
                        <td style="color:rgba(233,255,242,.75)">${u.inf||0}</td>
                        <td style="color:rgba(233,255,242,.65)">${u.by?fmt(u.by):"—"}</td>`;
        tb.appendChild(tr);
      });
    }

    function claim(){
      const s = init();
      if(s.me){ toast("ALREADY HAS ID"); return; }

      const ref = getRef();
      const id = s.next++;
      const me = { id, by: ref || null, inf: 0 };
      s.me = me;
      s.users[String(id)] = me;

      // demo: если origin есть локально — накинем ему +1
      if(ref && s.users[String(ref)]) s.users[String(ref)].inf = (s.users[String(ref)].inf||0) + 1;

      save(s);

      // сразу обновим URL (чтобы ощущалось как игра)
      history.replaceState(null, "", buildLink(id));

      toast("ID ISSUED: " + fmt(id));
      render();
    }

    function infect(){
      copyLink();
      toast("SEND LINK TO A FRIEND");
    }

    function buildChain(){
      const s = init();
      if(!s.me){ toast("GET ID FIRST"); return; }
      let cur = s.me, chain = [], guard = 0;
      while(cur && guard++ < 30){
        chain.push(fmt(cur.id));
        if(!cur.by) break;
        cur = s.users[String(cur.by)] || { id: cur.by, by:null, inf:0 };
      }
      $("chainTxt").textContent = chain.join("  →  ");
      toast("CHAIN READY");
    }

    function reset(){
      localStorage.removeItem(LS);
      toast("RESET");
      render();
      show("menu");
      $("chainTxt").textContent = "—";
    }

    function fullscreen(){
      const el = document.documentElement;
      if(!document.fullscreenElement) el.requestFullscreen?.();
      else document.exitFullscreen?.();
    }

    // background setup
    (function setupBg(){
      const vid = $("bgVid");
      const img = $("bgImg");

      if(BG_VIDEO_URL){
        vid.src = BG_VIDEO_URL;
        vid.style.display = "block";
        img.style.display = "none";
      }else if(BG_IMAGE_URL){
        img.src = BG_IMAGE_URL;
        img.style.display = "block";
        vid.style.display = "none";
      }else{
        // если пусто — просто оставим “энерго-фон” без файла
        vid.style.display = "none";
        img.style.display = "none";
      }
    })();

    // wire
    $("btnClaim").onclick = claim;
    $("btnInfect").onclick = infect;
    $("btnCopy").onclick = copyLink;
    $("btnCopyHud").onclick = copyLink;
    $("btnReset").onclick = reset;

    $("goTop").onclick = ()=>show("top");
    $("goChain").onclick = ()=>show("chain");
    $("back1").onclick = ()=>show("menu");
    $("back2").onclick = ()=>show("menu");
    $("btnBuild").onclick = buildChain;

    $("btnFull").onclick = fullscreen;

    show("menu");
    render();
  </script>
</body>
</html>
