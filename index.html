<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Outbreak Link</title>
  <style>
    :root{
      --bg:#05070B;
      --panel:rgba(10,14,18,.72);
      --border:rgba(255,255,255,.12);
      --t1:#EAF7F1;
      --t2:rgba(234,247,241,.68);
      --g:#45FF75;
      --c:#2FA9FF;
      --r:#FF3D4D;
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--t1);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #app{position:fixed;inset:0;overflow:hidden}

    /* subtle “game feel” overlay */
    #app::before{
      content:""; position:absolute; inset:-20px; pointer-events:none;
      background:
        repeating-linear-gradient(to bottom, rgba(255,255,255,.05) 0 1px, rgba(0,0,0,0) 1px 6px);
      opacity:.08; mix-blend-mode:overlay;
    }

    /* ---------- SCREENS ---------- */
    .screen{position:absolute;inset:0;display:none;align-items:center;justify-content:center}
    .screen.active{display:flex}

    /* ---------- COMMON UI ---------- */
    .panel{
      width:min(520px,92vw);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:18px;
      backdrop-filter: blur(10px);
      box-shadow:0 22px 90px rgba(0,0,0,.55);
    }
    h1,h2{margin:0}
    .muted{color:var(--t2);line-height:1.55;margin:10px 0 16px}
    .col{display:flex;flex-direction:column;gap:10px}

    .btn{
      all:unset;
      user-select:none; cursor:pointer;
      padding:12px 14px; border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--t1);
      letter-spacing:.10em; text-transform:uppercase; font-weight:800;
      backdrop-filter: blur(10px);
      text-align:center;
    }
    .btn.primary{background:rgba(69,255,117,.16)}
    .btn.secondary{background:rgba(47,169,255,.10)}
    .btn:active{transform:translateY(1px)}
    .hint{margin-top:10px;color:rgba(234,247,241,.5);font-size:12px}

    /* ---------- BOOT ---------- */
    .bootWrap{width:min(520px,92vw)}
    .logo{letter-spacing:.14em;text-transform:uppercase;font-weight:900;margin:0 0 10px}
    .bootText{color:var(--t2);margin:0 0 16px}
    .bar{height:10px;border-radius:999px;border:1px solid var(--border);overflow:hidden;background:rgba(255,255,255,.05)}
    .fill{height:100%;width:0%;background:linear-gradient(90deg,var(--g),var(--c))}
    .tiny{margin-top:10px;color:rgba(234,247,241,.5);font-size:12px}

    /* ---------- INTRO ---------- */
    .introVideo{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      background:#000;
      filter:saturate(1.05) contrast(1.05);
    }
    .introHUD{
      position:absolute; inset:0;
      display:flex; align-items:flex-end; justify-content:space-between;
      padding:18px;
      pointer-events:none;
      gap:14px;
    }
    .introTag{
      pointer-events:none;
      max-width:min(560px,92vw);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:14px 16px;
      backdrop-filter: blur(10px);
      box-shadow:0 22px 90px rgba(0,0,0,.55);
    }
    .tagTitle{margin:0 0 6px;letter-spacing:.12em;text-transform:uppercase;font-weight:900}
    .tagSub{margin:0;color:var(--t2);line-height:1.45}
    .btnRow{display:flex;gap:10px;pointer-events:auto}

    /* ---------- LOBBY ---------- */
    #lobby{align-items:stretch;justify-content:stretch}
    .lobbyBg{
      position:absolute; inset:0;
      /* fallback gradient + optional image */
      background:
        radial-gradient(80% 60% at 50% 10%, rgba(69,255,117,.18), rgba(0,0,0,.78)),
        url("assets/img/lobby_bg.jpg");
      background-position:center;
      background-size:cover;
      background-repeat:no-repeat;
      filter: saturate(1.05) contrast(1.05);
    }
    .lobbyTop{position:absolute; top:16px; left:16px; right:16px; display:flex; justify-content:flex-start; z-index:5}
    .playerCard{
      width:min(360px,92vw);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:14px 14px 12px;
      backdrop-filter: blur(10px);
      box-shadow:0 22px 90px rgba(0,0,0,.55);
    }
    .pcTitle{letter-spacing:.14em;text-transform:uppercase;font-weight:900;color:rgba(234,247,241,.78);font-size:12px}
    .pcId{font-weight:950;font-size:28px;letter-spacing:.08em;margin:4px 0 2px}
    .pcMeta{color:var(--t2);font-size:13px}
    .xpBar{height:10px;border-radius:999px;border:1px solid var(--border);overflow:hidden;background:rgba(255,255,255,.05);margin-top:10px}
    .xpFill{height:100%;background:linear-gradient(90deg,var(--g),var(--c));width:28%}

    .lobbyCenter{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap:10px; z-index:5;
      padding:20px;
    }
    .btn.big{padding:16px 18px;border-radius:16px;font-size:14px}
    .centerSub{color:var(--t2);letter-spacing:.06em;text-transform:uppercase;font-size:12px}

    .tabbar{
      position:absolute; left:12px; right:12px; bottom:12px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:20px;
      display:grid;
      grid-template-columns: 1fr 1fr 1.2fr 1fr 1fr;
      gap:8px;
      padding:10px;
      z-index:10;
      backdrop-filter: blur(10px);
      box-shadow:0 22px 90px rgba(0,0,0,.55);
    }
    .tab{
      all:unset; cursor:pointer;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:6px;
      padding:10px 8px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      user-select:none;
      transition:transform .08s ease, background .12s ease, border-color .12s ease;
    }
    .tab:hover{transform:translateY(-1px)}
    .tab:active{transform:translateY(0px)}
    .tab img{width:22px;height:22px;opacity:.95}
    .tab span{font-size:11px;letter-spacing:.12em;text-transform:uppercase;font-weight:900;color:rgba(234,247,241,.82)}
    .tabPlay{background:rgba(69,255,117,.14);border-color:rgba(69,255,117,.25)}
    .tab.active{background:rgba(47,169,255,.12);border-color:rgba(47,169,255,.25)}

    /* ---------- LOBBY DRAWER (tab content) ---------- */
    .drawer{
      position:absolute;
      left:12px; right:12px;
      bottom:86px;
      z-index:9;
      display:none;
    }
    .drawer.active{display:block}
    .drawerPanel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:20px;
      padding:14px;
      backdrop-filter: blur(10px);
      box-shadow:0 22px 90px rgba(0,0,0,.55);
    }
    .drawerHead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:10px;
    }
    .drawerTitle{
      letter-spacing:.12em;text-transform:uppercase;font-weight:900;
      margin:0;
    }
    .closeX{
      all:unset; cursor:pointer;
      width:36px;height:36px;border-radius:12px;
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      font-weight:900;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .field{
      width:100%;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.05);
      padding:12px 12px;
      color:rgba(234,247,241,.9);
      font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .mini{font-size:12px;color:rgba(234,247,241,.58);line-height:1.5;margin:8px 0 0}

    /* mobile safe areas */
    @supports(padding:max(0px)){
      .introHUD{padding: max(18px, env(safe-area-inset-top)) max(18px, env(safe-area-inset-right)) max(18px, env(safe-area-inset-bottom)) max(18px, env(safe-area-inset-left));}
      .tabbar{left:max(12px, env(safe-area-inset-left));right:max(12px, env(safe-area-inset-right));bottom:max(12px, env(safe-area-inset-bottom));}
      .drawer{left:max(12px, env(safe-area-inset-left));right:max(12px, env(safe-area-inset-right));bottom:calc(max(86px, env(safe-area-inset-bottom) + 74px));}
      .lobbyTop{left:max(16px, env(safe-area-inset-left));right:max(16px, env(safe-area-inset-right));top:max(16px, env(safe-area-inset-top));}
    }
  </style>
</head>
<body>
  <div id="app">

    <!-- BOOT -->
    <div class="screen active" id="boot">
      <div class="bootWrap">
        <h1 class="logo">OUTBREAK LINK</h1>
        <p class="bootText">Initializing Outbreak Protocol…</p>
        <div class="bar"><div class="fill" id="bootFill"></div></div>
        <div class="tiny">v0.1 local build • no backend • no accounts</div>
      </div>
    </div>

    <!-- INTRO -->
    <div class="screen" id="intro">
      <video class="introVideo" id="introVideo" playsinline muted autoplay></video>
      <div class="introHUD">
        <div class="introTag">
          <div class="tagTitle">This virus infects a link.</div>
          <p class="tagSub">Get your Infection ID. Spread it. Climb the monthly ranking.</p>
        </div>
        <div class="btnRow">
          <button class="btn" id="skipBtn">SKIP</button>
          <button class="btn primary" id="enterBtn">ENTER</button>
        </div>
      </div>
    </div>

    <!-- LOGIN -->
    <div class="screen" id="login">
      <div class="panel">
        <h2 style="letter-spacing:.12em;text-transform:uppercase">Continue</h2>
        <p class="muted">Sign in to save your Infection ID, chain, and season rank.</p>
        <div class="col">
          <button class="btn secondary" id="googleBtn">Google (later)</button>
          <button class="btn secondary" id="tgBtn">Telegram (later)</button>
          <button class="btn primary" id="guestBtn">Guest</button>
        </div>
        <div class="hint">This is a placeholder login. Next step: real auth + backend.</div>
      </div>
    </div>

    <!-- LOBBY -->
    <div class="screen" id="lobby">
      <div class="lobbyBg"></div>

      <div class="lobbyTop">
        <div class="playerCard">
          <div class="pcTitle">INFECTED</div>
          <div class="pcId" id="uiId">#000001</div>
          <div class="pcMeta">
            <span id="uiCountry">AT</span> • <span id="uiRank">Season Rank: #—</span>
          </div>
          <div class="xpBar"><div class="xpFill"></div></div>
        </div>
      </div>

      <div class="lobbyCenter">
        <button class="btn primary big" id="playBtn">PLAY RUN</button>
        <div class="centerSub">45 seconds. Contain the outbreak.</div>
      </div>

      <!-- tab content drawer -->
      <div class="drawer" id="drawer">
        <div class="drawerPanel">
          <div class="drawerHead">
            <h3 class="drawerTitle" id="drawerTitle">INFECT</h3>
            <button class="closeX" id="drawerClose">✕</button>
          </div>
          <div id="drawerBody"></div>
        </div>
      </div>

      <!-- tab bar -->
      <div class="tabbar">
        <button class="tab" id="tab_infect" data-tab="infect">
          <img src="assets/ui/icon_infect.png" alt="">
          <span>INFECT</span>
        </button>
        <button class="tab" id="tab_world" data-tab="world">
          <img src="assets/ui/icon_world.png" alt="">
          <span>WORLD</span>
        </button>
        <button class="tab tabPlay" id="tab_play" data-tab="play">
          <img src="assets/ui/icon_play.png" alt="">
          <span>PLAY</span>
        </button>
        <button class="tab" id="tab_lineage" data-tab="lineage">
          <img src="assets/ui/icon_lineage.png" alt="">
          <span>LINEAGE</span>
        </button>
        <button class="tab" id="tab_top" data-tab="top">
          <img src="assets/ui/icon_top.png" alt="">
          <span>TOP</span>
        </button>
      </div>
    </div>

  </div>

  <script>
    // ---------- ROUTER ----------
    const screens = {
      boot:  document.getElementById('boot'),
      intro: document.getElementById('intro'),
      login: document.getElementById('login'),
      lobby: document.getElementById('lobby'),
    };
    function show(name){
      Object.values(screens).forEach(s=>s.classList.remove('active'));
      screens[name].classList.add('active');
    }

    // ---------- BOOT ----------
    const fill = document.getElementById('bootFill');
    let p = 0;
    const bootTimer = setInterval(()=>{
      p += 8;
      fill.style.width = Math.min(p,100) + '%';
      if(p >= 100){
        clearInterval(bootTimer);
        startIntro();
      }
    }, 60);

    // ---------- INTRO ----------
    const introVideo = document.getElementById('introVideo');
    const skipBtn = document.getElementById('skipBtn');
    const enterBtn = document.getElementById('enterBtn');

    function startIntro(){
      show('intro');
      introVideo.src = 'assets/video/intro.mp4';
      introVideo.addEventListener('ended', ()=> goLogin(), {once:true});
      // если видео нет/пустое — просто остаёмся на интро, кнопки всё равно работают
    }
    function goLogin(){
      try{ introVideo.pause(); }catch(e){}
      show('login');
    }
    skipBtn.onclick = goLogin;
    enterBtn.onclick = goLogin;

    // ---------- LOGIN ----------
    document.getElementById('googleBtn').onclick = ()=> alert('Google login will be added on later step.');
    document.getElementById('tgBtn').onclick     = ()=> alert('Telegram login will be added on later step.');
    document.getElementById('guestBtn').onclick  = ()=> show('lobby');

    // ---------- LOBBY TABS ----------
    const drawer = document.getElementById('drawer');
    const drawerTitle = document.getElementById('drawerTitle');
    const drawerBody  = document.getElementById('drawerBody');
    const drawerClose = document.getElementById('drawerClose');
    const tabs = Array.from(document.querySelectorAll('.tab'));

    function setActiveTab(tabName){
      tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab === tabName));
    }

    function openDrawer(title, html){
      drawerTitle.textContent = title;
      drawerBody.innerHTML = html;
      drawer.classList.add('active');
    }
    function closeDrawer(){
      drawer.classList.remove('active');
      setActiveTab(null);
    }
    drawerClose.onclick = closeDrawer;

    function getBaseUrl(){
      // работает и на file:// и на http(s)://
      const clean = window.location.href.split('#')[0].split('?')[0];
      return clean;
    }
    const myId = '000001'; // позже будет с сервера
    function infectLink(){
      return `${getBaseUrl()}?ref=${myId}`;
    }

    function tabInfect(){
      setActiveTab('infect');
      openDrawer('INFECT', `
        <div class="mini">Your personal infection link (share it):</div>
        <div class="field" id="linkField">${infectLink()}</div>
        <div class="row" style="margin-top:10px">
          <button class="btn primary" id="copyLinkBtn">COPY LINK</button>
          <button class="btn secondary" id="openTgBtn">OPEN TELEGRAM</button>
        </div>
        <div class="mini">
          Infection counts will be saved later (backend). For now this is UI prototype.
        </div>
      `);

      const copyBtn = document.getElementById('copyLinkBtn');
      const openTgBtn = document.getElementById('openTgBtn');

      copyBtn.onclick = async ()=>{
        try{
          await navigator.clipboard.writeText(infectLink());
          copyBtn.textContent = 'COPIED';
          setTimeout(()=>copyBtn.textContent='COPY LINK', 900);
        }catch(e){
          alert('Clipboard blocked. Copy manually from the field.');
        }
      };

      openTgBtn.onclick = ()=>{
        // позже подставим реальную ссылку на твой тгк
        alert('Later: open your TG channel / bot.');
      };
    }

    function tabWorld(){
      setActiveTab('world');
      openDrawer('WORLD', `
        <div class="mini">World outbreak map + country timeline (will be real after backend).</div>
        <div class="field">Timeline: #1 AT → #2 DE → #3 ...</div>
        <div class="mini">Here we will show: infections/day, speed, first carrier per country.</div>
      `);
    }

    function tabLineage(){
      setActiveTab('lineage');
      openDrawer('LINEAGE', `
        <div class="mini">Who infected who. Your chain (prototype).</div>
        <div class="field">Infected by: #------</div>
        <div class="field" style="margin-top:10px">Path to CREATOR: #000001 → ...</div>
      `);
    }

    function tabTop(){
      setActiveTab('top');
      openDrawer('TOP', `
        <div class="mini">Monthly season leaderboard (prototype).</div>
        <div class="field">#1  INFECTED #000120  —  184 infections</div>
        <div class="field" style="margin-top:8px">#2  INFECTED #000381  —  152 infections</div>
        <div class="field" style="margin-top:8px">#3  INFECTED #000905  —  99 infections</div>
        <div class="mini">Winners later: prize + video message in TG channel.</div>
      `);
    }

    function tabPlay(){
      // пока просто показываем, что кнопка живая
      setActiveTab('play');
      closeDrawer();
      alert('Next step: RUN (45 seconds) prototype game loop.');
    }

    // tab clicks
    document.getElementById('tab_infect').onclick  = tabInfect;
    document.getElementById('tab_world').onclick   = tabWorld;
    document.getElementById('tab_lineage').onclick = tabLineage;
    document.getElementById('tab_top').onclick     = tabTop;
    document.getElementById('tab_play').onclick    = tabPlay;
    document.getElementById('playBtn').onclick     = tabPlay;
  </script>
</body>
</html>
